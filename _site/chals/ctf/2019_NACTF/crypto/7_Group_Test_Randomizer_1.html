<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    
        

    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:title" content="jebidiah-anthony">
    <meta name="twitter:description" content="">
    <meta name="twitter:site" content="@jebidiah-anthony" />
    <meta name="twitter:creator" content="@feeeellliix">

    
    <meta property="og:image" content="https://jebidiah-anthony.github.io/banner.jpg" />
    

    

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>jebidiah-anthony</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="jebidiah-anthony" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://jebidiah-anthony.github.io/chals/ctf/2019_NACTF/crypto/7_Group_Test_Randomizer_1.html" />
<meta property="og:url" content="https://jebidiah-anthony.github.io/chals/ctf/2019_NACTF/crypto/7_Group_Test_Randomizer_1.html" />
<meta property="og:site_name" content="jebidiah-anthony" />
<script type="application/ld+json">
{"@type":"WebPage","headline":"jebidiah-anthony","url":"https://jebidiah-anthony.github.io/chals/ctf/2019_NACTF/crypto/7_Group_Test_Randomizer_1.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <style>
      .user_host { color: green; }
      .sys_dir { color: #779ECB; }
      p { color:#aaa; }
      header { margin-bottom: 0px; }
      .header .navbtn {
	position: fixed;
	width: 0px;
	visibility: hidden;
      }
      .header .title { 
	padding-left: 69px;
	vertical-align: middle;
      }
      .header .title h2 { margin: 0; } 

      .container {
	max-width: 1200px;
      }
      .sidebar {
        border-right: 1px dashed #b5e853;
	bottom: 0;
        height: 100%;
	overflow: auto;
	padding: 10px 10px 10px 10px;
        position: fixed;
	top: 0;
        width: 230px;
      }
      .openbtn { 
	color:#b5e853;
	font-size:30px;
	cursor:pointer
      }
      .closebtn {
	color:#b5e853;
	font-size:69px;
	cursor:pointer;
	position:absolute;
	top:0;
	right:25px;
	font-size:36px;
	margin-left:50px;
	visibility:hidden;
      }
      
      .ctf_content {
        margin-left: 250px;
	padding-bottom: 5px;
      }
      .ctf_content h2 {	padding: 20px 0px 0px 10px; }
      .ctf_content h3 { margin: 20px 0px 0px 10px; }
      .ctf_content img {
 	display: block;
	margin-left: auto;
	margin-right: auto;
	max-width: 100%;
	padding: 0 10px 0 0;
      }
      .ctf_content table { padding: 0 15px; }

      #main_content h1 { padding: 20px 0px 0px 8px; }
      #main_content h2, p, pre { 
	padding-right:10px;
	padding-left:15px; 
      }
      #main_content h4 { 
        margin: 20px 0px 10px 0px; 
        padding-left: 25px; 
      }
      #main_content ol, ul { margin: 0 0 0 10px; }

      .highlighter-rouge { padding: 0 10px 0 10px; }

      .section-divider{
        border-bottom: 1.5px solid #b5e853;
        padding-top:28px;
        width:55%;
      }
      
      @media screen and (min-width: 801px) {
	.ctf_content {
          margin-left: 250px;
	  padding-bottom: 5px;
        }
      }
      @media screen and (max-width: 800px) {
        header {
	  background-color: #202020;
	  height: 80px;
	  padding: 0px 0 0 0;
	  position: fixed;
	  top: 0;
	}
        .header .navbtn {
          height: 80px;
	  padding: 18px 0 0 20px;
          visibility: visible;
	  width: 100px;
        }
	.header .title { padding-left: 100px; }
	.header .title h1 { padding-top: 5px; }
        .header .title h2 { margin: 0; }

	.container {
	  width:100%;
	}
	.sidebar {
          width: 0;
          z-index: 1;
          overflow-x: hidden;
	  padding: 0;
          transition: 0.5s;
	}
	.sidebar h2 { 
	  font-size: 18px; 
	  padding: 10px 10px 5px 10px;
	}
	.sidebar div { 
	  font-size: 15px; 
	  padding: 5px 10px 5px 10px;
	}
	.closebtn { visibility:visible; }

	.highlighter-rouge { padding: 0 0 0 0; }

	.ctf_content {
	  margin: 0;
	}
	.ctf_content h2 { padding: 15px 0px 0px 5px; }
        .ctf_content h3 { margin: 15px 10px 0px 15px; }
        .ctf_content img {
	  max-width: 100%;
	  padding: 0 10px 0 0;
        }
	.ctf_content table { 
	  margin: 0 10px 0px -8px;
	  min-width: 800px;
	}

        #main_content { margin-top:80px; }
	#main_content code { font-size: 15px; }
	#main_content h1 { font-size: 25px; }
	#main_content h2 { font-size: 22px; }
	#main_content h3 { font-size: 18px; }
	#main_content h4 { padding-left: 20px; }
	#main_content ol, ul {
	  font-size: 14px;
	  margin: 0 0 0 12px;
	  padding: 0 0 0 25px;
	}
	#main_content table { font-size: 14px; }
      }

      @media screen and (max-width: 480px) {
        header {
	  background-color: #202020;
	  height: 70px;
	  padding: 0px 0 0 0;
	  position: fixed;
	  top: 0;
	}
        .header .navbtn {
          height: 70px;
	  padding: 14px 0 0 18px;
        }
	.header .title { padding-left: 100px; }
	.header .title h1 { font-size:22px; }
        .header .title h2 { font-size:16px; }

	#main_content code { font-size: 13px; }
        #main_content ol, ul {
	  font-size: 13px;
	  margin: 0 0 0 12px;
	  padding: 0 0 0 25px;
	}
	#main_content table { font-size: 13px; }
      }
    </style>

  </head>

  <body>
    <div class="container">
       <div id="sidebar" class="sidebar">
         <span class="closebtn" onclick="closeNav()">&times;</span>      
	 <div><h2 style="margin-bottom:0; padding-top:20px">[SITE PAGES]</h2>

<div style="padding-top:10px">
  
  > <a href="/">whoami</a>
  
</div>
<div style="padding-top:10px">  
  >  <a href="/htb.html">
    
    htb writeups
    
  </a>
</div>
<div style="padding-top:10px">
  > <a href="/ctf.html">
    
    <strong style="color:orange">ctf writeups</strong>
    
  </a>
</div>
<div style="padding-top:10px">
  > <a href="/projects.html">
    
    projects
    
  </a>
</div>
</div>
	 <div style="padding-bottom:20px">
           
	     <h2 style="margin-bottom:0; padding-top: 20px">[HTB CHALLENGES]</h2>


<div style="padding-top:10px">
  > <a href="https://jebidiah-anthony.github.io/chals/htb/challenges.html#for">
  
  Forensics
  
  </a>
</div>

<div style="padding-top:10px">
  > <a href="https://jebidiah-anthony.github.io/chals/htb/challenges.html#mob">
  
  Mobile
  
  </a>
</div>

<div style="padding-top:10px">
  > <a href="https://jebidiah-anthony.github.io/chals/htb/challenges.html#pwn">
  
  Pwn
  
  </a>
</div>

<div style="padding-top:10px">
  > <a href="https://jebidiah-anthony.github.io/chals/htb/challenges.html#web">
  
  Web
  
  </a>
</div>


             <h2 style="margin-bottom:0; padding-top:20px">[CTF EVENTS]</h2>


<div style="padding-top:10px">
  > <a href="https://jebidiah-anthony.github.io/chals/ctf/2020-ROOTCONEasterEggHunt.html">
  
  ROOTCON Easter Egg Hunt 2020
  
  </a>
</div>

<div style="padding-top:10px">
  > <a href="https://jebidiah-anthony.github.io/chals/ctf/2019-XMASCTF.html">
  
  X-MAS CTF 2019
  
  </a>
</div>

<div style="padding-top:10px">
  > <a href="https://jebidiah-anthony.github.io/chals/ctf/2019-CyberSEAGame.html">
  
  Cyber SEA Game 2019
  
  </a>
</div>

<div style="padding-top:10px">
  > <a href="https://jebidiah-anthony.github.io/chals/ctf/2019-NACTF.html">
  
  <strong style="color:orange;text-decoration:none">NACTF 2019</strong>
  
  </a>
</div>

<div style="padding-top:10px">
  > <a href="https://jebidiah-anthony.github.io/chals/ctf/2019-TGHack.html">
  
  TG:Hack 2019
  
  </a>
</div>

<div style="padding-top:10px">
  > <a href="https://jebidiah-anthony.github.io/chals/ctf/2019-TJCTF.html">
  
  TJCTF 2019
  
  </a>
</div>


	   
	 </div>
       </div>
       <div id="content" class="ctf_content">
	 <header>
           <div class="header">
             <div class="navbtn">
               <span class="openbtn" onclick="openNav()">&#9776;</span>
	     </div>
	     <div class="title">
               <h1>jebidiah-anthony</h1>
               <h2 style="padding:0 0 0 0">write-ups and what not</h2>
	     </div>
           </div>
         </header>
         <section id="main_content"><h2 id="dr-js-group-test-randomizer-1"><span style="color:red">Dr. J’s Group Test Randomizer #1</span></h2>

<hr />

<h3 id="part-1--challenge-description">PART 1 : CHALLENGE DESCRIPTION</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Dr. J is back with another group test, and he patched his prng so we 
can't predict the next number based on the previous one! Can still 
you help Leaf predict the next output of the prng?

nc shell.2019.nactf.com 31258
</code></pre></div></div>

<hr />

<h3 id="part-2--given-files">PART 2 : GIVEN FILES</h3>

<h4 id="-class-randomizer-1c"><strong>[&gt;]</strong> <a href="./files/class-randomizer-1.c">class-randomizer-1.c</a></h4>

<hr />

<h3 id="part-3--program-flow">PART 3 : PROGRAM FLOW</h3>

<ol>
  <li>A seed is initialized:
    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">uint64_t</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">init_seed</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">uint64_t</span> <span class="n">r1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span> <span class="n">randombytes_random</span><span class="p">();</span>
  <span class="kt">uint64_t</span> <span class="n">r2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span> <span class="n">randombytes_random</span><span class="p">();</span>
  <span class="n">seed</span> <span class="o">=</span> <span class="p">(</span><span class="n">r1</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">+</span> <span class="n">r2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <p><strong>NOTE(S)</strong>:</p>
    <ol>
      <li>The generated seed has a maximum value of <strong><code class="highlighter-rouge">0xffffffff</code></strong>.</li>
    </ol>
  </li>
  <li>An actions menu is presented to the user:
    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Welcome to Dr. J's Random Number Generator v2! A vulnerability involving "</span>
<span class="s">"predictability of outputs has been patched. </span><span class="se">\n</span><span class="s">"</span>
<span class="s">"[r] Print a new random number </span><span class="se">\n</span><span class="s">"</span>
<span class="s">"[g] Guess the next four random numbers and receive the flag! </span><span class="se">\n</span><span class="s">"</span>
<span class="s">"[q] Quit </span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
</code></pre></div>    </div>
    <ol>
      <li><strong><code class="highlighter-rouge">[r]</code></strong> generates a new random number:
        <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">uint64_t</span> <span class="nf">nextRand</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Keep the 8 middle digits from 5 to 12 (inclusive) and square.</span>
  <span class="n">seed</span> <span class="o">=</span> <span class="n">getDigits</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
  <span class="n">seed</span> <span class="o">*=</span> <span class="n">seed</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">getDigits</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>        </div>
        <p><strong>NOTE(S)</strong>:</p>
        <ol>
          <li>The <strong>5th</strong> to the <strong>8th</strong> digits from the right of the seed is squared.</li>
          <li>The squared number is now the new seed.</li>
          <li>This time, the “random” number generated is no longer the new seed.
            <ul>
              <li>It is now The 13th to the 16th digits (from the right) or the leading digits of the new seed.</li>
            </ul>
          </li>
        </ol>
      </li>
      <li>
        <p><strong><code class="highlighter-rouge">[g]</code></strong> lets the user guess the next four “random” numbers to get the flag.</p>
      </li>
      <li><strong><code class="highlighter-rouge">[q]</code></strong> lets the user exit the program.</li>
    </ol>
  </li>
</ol>

<hr />

<h3 id="part-4--getting-the-flag">PART 4 : GETTING THE FLAG</h3>

<ol>
  <li>Write a script that approximates the initial middle value used to generate the first number:
    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>
   
<span class="k">def</span> <span class="nf">approximateMiddleValue</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>                  <span class="c1"># In order to generate the next "random" numbers, the seed
</span>    <span class="n">curr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>                               <span class="c1"># used to generate the first number should be known.
</span>    <span class="n">root</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">curr</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>                    <span class="c1">#
</span>                                                  <span class="c1"># The first number generated is the 13th-16th digits (from 
</span>    <span class="k">return</span> <span class="n">root</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="n">root</span><span class="o">+</span><span class="mi">100</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>       <span class="c1"># the right) or basically the leading digits of the middle
</span>                                                  <span class="c1"># square value of the initial or current seed.
</span><span class="k">def</span> <span class="nf">getNextRand</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>                            <span class="c1">#
</span>    <span class="n">mid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">seed</span><span class="p">)[</span><span class="o">-</span><span class="mi">12</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>                       <span class="c1"># The initial or seed's middle value used to generate the
</span>    <span class="n">m_s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>                             <span class="c1"># first number could be approximated by taking the square
</span>                                                  <span class="c1"># root of the first number multiplied by a hundred to 
</span>    <span class="k">return</span> <span class="n">m_s</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">m_s</span><span class="p">)[:</span><span class="o">-</span><span class="mi">12</span><span class="p">]</span>                    <span class="c1"># increase its precision then rounding it down. All this
</span>                                                  <span class="c1"># times 10^4 should be quite near the initial seed value.          
</span><span class="n">min_val</span><span class="p">,</span><span class="n">max_val</span> <span class="o">=</span> <span class="n">approximateMiddleValue</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#
</span>                                                  <span class="c1"># With the limited number of middle values to work with,
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">):</span>                 <span class="c1"># bruteforcing the initial seed and generating new numbers
</span>    <span class="n">seed</span> <span class="o">=</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span>                                   <span class="c1"># should no longer be a problem.  
</span>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">seed</span><span class="p">)[:</span><span class="o">-</span><span class="mi">12</span><span class="p">]</span> <span class="o">==</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>                <span class="c1">#
</span>        <span class="n">seed</span><span class="p">,</span><span class="n">num</span> <span class="o">=</span> <span class="n">getNextRand</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>              <span class="c1"># This code requires three succeeding numbers generated to       
</span>        <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>                        <span class="c1"># make sure that the program returns accurate results.       
</span>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>                     
                <span class="n">seed</span><span class="p">,</span><span class="n">num</span> <span class="o">=</span> <span class="n">getNextRand</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>               
                <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">num</span><span class="o">!=</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="k">break</span>   
                <span class="k">elif</span> <span class="n">x</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span> <span class="k">break</span>   
</code></pre></div>    </div>
  </li>
  <li>Run the PRNG and generate three (3) “random” numbers:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>nc shell.2019.nactf.com 31258
<span class="go">
  Welcome to Dr. J's Random Number Generator v2! A vulnerability involving predictability of outputs has been patched. 
  [r] Print a new random number 
  [g] Guess the next four random numbers and receive the flag! 
  [q] Quit

</span><span class="gp">$</span><span class="w"> </span><span class="o">&gt;</span> r
<span class="go">  95
</span><span class="gp">$</span><span class="w"> </span><span class="o">&gt;</span> r
<span class="go">  5453
</span><span class="gp">$</span><span class="w"> </span><span class="o">&gt;</span> r
<span class="go">  2112
</span><span class="gp">$</span><span class="w"> </span><span class="o">&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>Run the python script above to generate the next four numbers:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>python3 class-randomizer-1.py 95 5453 2112
<span class="go">  1498
  5923
  50
  123
</span></code></pre></div>    </div>
  </li>
  <li>Go back to the running PRNG and submit the next four numbers generated by te script:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="o">&gt;</span> g
<span class="go">     
  Guess the next four random numbers for a flag! Dr. Strange sees fourteen million six hundred and five possibilies... and you only guess correctly in one. Good luck!
  Enter your first guess:
</span><span class="gp">$</span><span class="w"> </span><span class="o">&gt;</span> 1498
<span class="go">
  Yeah, yeah, one correct guess is easy.
  Enter your second guess:
</span><span class="gp">$</span><span class="w"> </span><span class="o">&gt;</span> 5923
<span class="go">
  Okay, you're lucky... You won't be able to guess right a third time.
  Enter your third guess:
</span><span class="gp">$</span><span class="w"> </span><span class="o">&gt;</span> 50
<span class="go">
  Wow. I'll admit I'm impressed. This is the final test. 
  Enter your fourth guess:
</span><span class="gp">$</span><span class="w"> </span><span class="o">&gt;</span> 123
<span class="go"> 
  Oh no... we're in the endgame now... Here's your flag:
  nactf{th3_b35t_pr3d1ct0r_0f_fu7ur3_b3h4v10r_15_p4st_b3h4v10r}

</span></code></pre></div>    </div>
  </li>
</ol>

<hr />

<h2 id="flag--nactfth3_b35t_pr3d1ct0r_0f_fu7ur3_b3h4v10r_15_p4st_b3h4v10r">FLAG : <strong>nactf{th3_b35t_pr3d1ct0r_0f_fu7ur3_b3h4v10r_15_p4st_b3h4v10r}</strong></h2>
</section>
       </div>
    </div>

    <script>
      function openNav() {
        document.getElementById("sidebar").style.width = "250px";
        document.getElementById("content").style.marginLeft = "250px";
      }
      function closeNav() {
        document.getElementById("sidebar").removeAttribute("style");
        document.getElementById("content").removeAttribute("style");
      } 
    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'true', 'auto');
        ga('send', 'pageview');
      </script>
    
  </body>
</html>
